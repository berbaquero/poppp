// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;x=window;l=x.document;i=l.body;u=1;b=30;r=1;w=!1;s="popular";S=320;y={};p=0;h=0;v={};o="two";a="";n={Action:{goToMainView:function(){var e,t,r,i;n.HeaderTitle.text("Poppp").removeClass("title-shot").addClass("title-main");e=n.Button.Back;t=n.Button.Menu;r=n.Button.Open;i=n.Button.Refresh;e.addClass("invisible");r.addClass("invisible");t.removeClass("hide");i.removeClass("hide");setTimeout(function(){e.addClass("hide");r.addClass("hide");t.removeClass("invisible");return i.removeClass("invisible")},351);return n.Anims.slideFromLeft()},goToDetailView:function(){var e,t,r,i;n.Anims.slideFromRight();e=n.Button.Back;t=n.Button.Menu;r=n.Button.Open;i=n.Button.Refresh;e.removeClass("hide");r.removeClass("hide");t.addClass("invisible");i.addClass("invisible");n.Misc.setMinImgSize();return setTimeout(function(){e.removeClass("invisible");r.removeClass("invisible");t.addClass("hide");return i.addClass("hide")},351)},setHeaderShotTitle:function(e){return n.HeaderTitle.text(y[e].title).addClass("title-shot").removeClass("title-main")},toggleMenu:function(e){w=e?0:1;return n.Menu.css("-webkit-transform",e?"translate3d(0, 0, 0)":"translate3d(0, 344px, 0)")}},MainView:$("#mainView"),DetailView:$("#detailView"),MainWrap:$("#mainWrap"),DetailWrap:$("#detailWrap"),HeaderTitle:$(".title"),Header:$("header"),Menu:$("#menu"),Button:{Back:$("#nav-back"),Open:$("#open-shot"),Menu:$("#show-menu"),Refresh:$("#refresh")},Anims:{slideFromRight:function(){var e,t;n.Misc.getWidth();t=n.MainView;e=n.DetailView;e.css("left",S);return setTimeout(function(){var n,i;i="translate3d(-"+S+"px, 0px, 0px)";n={"-webkit-transform":i,transform:i};t.addClass("slideTransition").css(n);e.addClass("slideTransition").css(n);return setTimeout(function(){var n;n={"-webkit-transform":"",transform:""};e.css("left",0).removeClass("slideTransition").removeClass("fuera").css(n);t.removeClass("slideTransition").addClass("fuera").css(n);return r=2},351)},100)},slideFromLeft:function(){var e,t;n.Misc.getWidth();t=n.MainView;e=n.DetailView;t.css("left",-S);setTimeout(function(){t.addClass("slideTransition").css("-webkit-transform","translate3d("+S+"px, 0px, 0px)");e.addClass("slideTransition").css("-webkit-transform","translate3d("+S+"px, 0px, 0px)");return setTimeout(function(){t.removeClass("slideTransition").css({"-webkit-transform":"",left:""}).removeClass("fuera");e.css({"-webkit-transform":"",left:""}).removeClass("slideTransition");return e.addClass("fuera")},351)},50);return r=1}},Misc:{setMinImgSize:function(){var e,t;t=n.Misc.getWidth();p=t-10;e=p*.75;return $("#detail-image > img").css({"min-height":e,"min-width":p})},getWidth:function(){S=i.offsetWidth;return S}}};t={getMainViewTemplate:function(e){e?e+="-column":e="";return"{{#shots}}<article class='shot-wrap "+e+"'><img class='shot' data-shot-id='{{id}}' src='{{image_teaser_url}}'/></article>{{/shots}}<div class='load-more'>Load more</div>"},detailView:"<div id='detail-image'><img src='{{image_url}}'/></div><div id='shot-info'><p>{{title}}</p><p>by {{player.name}}</p><p>{{likes_count}}</p></div><div id='force-overflow'></div>"};e={loadShots:function(t){n.MainWrap.append("<p class='main-message'>Loading shots...</p>");return $.ajax({dataType:"jsonp",url:e.getURL(),success:function(n){var r;e.showShots(n);if(t){r=v.shots.concat(n.shots);return v.shots=r}return v=n},error:function(){$(".main-message").text("Oops! Couldn't load shots. :(");return n.MainWrap.append("<div class='load-more'>Try reloading</div>")}})},showShots:function(e){var r,i,s,a,f,l;e||(e=v);$(".main-message").remove();r=Mustache.to_html(t.getMainViewTemplate(o),e);s=n.MainWrap;s.append(r);setTimeout(function(){return s.css("opacity",1)},100);i=e.shots;for(f=0,l=i.length;f<l;f++){a=i[f];if(y[a.id])continue;y[a.id]=a}return u++},getURL:function(){return"//api.dribbble.com/shots/"+s+"?page="+u+"&per_page="+b+"&callback=?"}};tappable(".shot",{onTap:function(e,r){var i,s,o;w&&n.Action.toggleMenu(w);o=$(r).data("shot-id");i=n.DetailWrap;s=Mustache.to_html(t.detailView,y[o]);i.html(s);a=y[o].url;n.Action.setHeaderShotTitle(o);return n.Action.goToDetailView()}});tappable(".load-more",{onTap:function(t,r){w&&n.Action.toggleMenu(w);$(r).remove();return e.loadShots(!0)},activeClass:"load-more-active"});tappable("#nav-back",{onTap:function(){a="";return n.Action.goToMainView()},activeClass:"btn-active"});tappable("#refresh",{onTap:function(){u=1;n.MainWrap.empty();w&&n.Action.toggleMenu(w);return e.loadShots()},activeClass:"btn-active"});tappable("#show-menu",{onTap:function(){if(r===1)return n.Action.toggleMenu(w)},activeClass:"btn-active"});tappable("#menu > p",{onTap:function(t,r){var i,o;i=$(r);o=i.text().toLowerCase();n.Action.toggleMenu(w);if(o===s)return;s=o;u=1;$("#menu > p.menu-active").removeClass("menu-active");i.addClass("menu-active");return setTimeout(function(){n.MainWrap.empty();return e.loadShots()},351)},activeClass:"options-active"});tappable("#layout-option p",{onTap:function(e,t){var r,i,s;r=$(t);n.Action.toggleMenu(w);r.toggleClass("two-icon");r.toggleClass("three-icon");i=n.MainWrap;o=o==="two"?"three":"two";s=$(".shot-wrap");s.toggleClass("two-column");return s.toggleClass("three-column")},activeClass:"options-active"});tappable("#open-shot",{onTap:function(){var e;e=x.confirm("View this shot in Dribbble.com?");if(e)return m(a)},activeClass:"btn-active"});E=typeof window.orientation!="undefined";c=function(){return window.pageYOffset||l.compatMode==="CSS1Compat"&&l.documentElement.scrollTop||i.scrollTop||0};g=function(){if(!E)return;i.style.height=screen.height+"px";return setTimeout(function(){var e;x.scrollTo(0,1);e=c();x.scrollTo(0,e===1?0:1);return i.style.height=x.innerHeight+"px"},1)};m=function(e){var t,n;if(!e)return;t=l.createElement("a");t.setAttribute("href",e);t.setAttribute("target","_blank");n=l.createEvent("HTMLEvents");n.initEvent("click",!0,!0);return t.dispatchEvent(n)};e.loadShots();g();n.Header.on("touchmove",function(e){return e.preventDefault()},!1);n.DetailWrap.on("touchmove",function(e){return e.preventDefault()},!1);x.applicationCache.addEventListener("updateready",function(e){var t;t=window.confirm("Update ready. Refresh to update?");if(t)return window.location.reload()});d=!/iPhone|iPod|iPad|Android/.test(navigator.userAgent);if(d){f=l.createElement("link");f.rel="stylesheet";f.href="css/desk.css";l.head.appendChild(f)}}).call(this);